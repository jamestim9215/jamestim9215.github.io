<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Game By Phaser</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
            background: #333;
        }

        canvas{
            position: relative;
            margin: 0 auto;
            display: inherit;
        }

    </style>
</head>
<body>

    
    <script>
        var config = {
            type: Phaser.AUTO,
            width: 1000,
            height: 600,
            physics: {
            default: 'arcade',
                arcade: {
                    gravity: { y: 1000 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        
        var player;
        var platforms;
        var cursors;

        var game = new Phaser.Game(config);

        function preload ()
        {
            this.load.image('bg', 'assets/bg.png');
            this.load.image('top', 'assets/top.png');
            this.load.image('left', 'assets/left.png');
            this.load.image('bottom', 'assets/bottom.png');
            this.load.image('right', 'assets/right.png');
            this.load.image('ground', 'assets/ground.png');

            this.load.spritesheet('chibi', 
                'assets/player.png',
                { frameWidth: 60, frameHeight: 50 }
            );

        }

        function create ()
        {
            this.add.image(500, 300, 'bg');

            platforms = this.physics.add.staticGroup(); //設定靜態物件 group ex: 牆壁
            platforms.create(500, 50, 'top');
            platforms.create(950, 300, 'right');
            platforms.create(500, 550, 'bottom'); 
            platforms.create(50, 300, 'left');

            platforms.create(500, 130+68, 'ground');
            platforms.create(190, 130+68+68+34, 'ground');
            platforms.create(810, 130+68+68+34, 'ground');
            platforms.create(500, 130+68+68+68+68, 'ground');

            player = this.physics.add.sprite(500, 300, 'chibi').setScale(1.2);
            player.setBounce(0.2); //反弹（bounce）值
            player.setCollideWorldBounds(true); //世界边界（bound）的碰撞

            this.anims.create({
                key: 'left',
                frames: this.anims.generateFrameNumbers('chibi', { start: 0, end: 1 }), //使用0, 1帧
                frameRate: 5, //每秒10帧
                repeat: -1 //告诉动画要循环播放
            });

            this.anims.create({
                key: 'turn',
                frames: [ { key: 'chibi', frame: 2 } ],
                frameRate: 20
            });

            this.anims.create({
                key: 'right',
                frames: this.anims.generateFrameNumbers('chibi', { start: 3, end: 4 }),
                frameRate: 5,
                repeat: -1
            });
            cursors = this.input.keyboard.createCursorKeys(); //添加事件监听器

            this.physics.add.collider(player, platforms); // 碰撞器（Collider）

        }

        function update ()
        {
            if (cursors.left.isDown)
            {
                player.setVelocityX(-300);

                player.anims.play('left', true);
            }
            else if (cursors.right.isDown)
            {
                player.setVelocityX(300);

                player.anims.play('right', true);
            }
            else
            {
                player.setVelocityX(0);

                player.anims.play('turn');
            }

            if (cursors.up.isDown && player.body.touching.down)
            {
                player.setVelocityY(-600);
            }
        }
    </script>
</body>
</html>