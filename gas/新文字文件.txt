

function doGet(e) {
  var params = e.parameter; 
  var apiType = params.apiType;
  var url = e.parameter.url; // 取得傳入 URL
  
  var response = UrlFetchApp.fetch(decodeURIComponent(url),{ // 發出 GET 請求，並設定 hearder json
    headers: { "Content-type" : "application/json" }
  });
  
  //sheet資訊
  var SpreadSheet = SpreadsheetApp.openById("1BPbNkINRICJUB7xIqhvFp5BfgFHn90bNvEQyLnRBpIo");
  var Sheet = SpreadSheet.getSheets()[0];
  var LastRow = Sheet.getLastRow();
  
  if(apiType == "getData"){
    var range = Sheet.getDataRange();
    //  var data = range.getValues();
    var data = Sheet.getSheetValues(2,1,LastRow-1,3);
    //回傳資訊
    return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON);
  }
  
  if(apiType == "setData"){ 
    var name = params.name;
    var phone = params.phone;
    var demand = params.demand;
    //存入資訊
    Sheet.getRange(LastRow+1, 1).setValue(name);
    Sheet.getRange(LastRow+1, 2).setValue(phone);
    Sheet.getRange(LastRow+1, 3).setValue(demand);
    
    //回傳資訊
    return ContentService.createTextOutput("成功");
  }
  
  if(apiType == 'deleteData'){
    var dataId = params.dataId;
    
    Sheet.deleteRow(dataId);

    //回傳資訊
    return ContentService.createTextOutput("成功");
  }
  
}